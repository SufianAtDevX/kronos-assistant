<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Kronos - Assistant</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;700&family=Saira:wght@400;600&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body { background-color: #000; font-family: 'Saira', sans-serif; overflow-x: hidden; }
        @keyframes float { 0% { transform: translateY(0px); } 50% { transform: translateY(-20px); } 100% { transform: translateY(0px); } }
        .floating-orb { animation: float 8s ease-in-out infinite; }
        .card-glow {
            position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            border-radius: 1.5rem; /* 24px */
            background: radial-gradient(circle at 50% 50%, rgba(128, 0, 128, 0.3), transparent 70%);
            opacity: 0; transition: opacity 0.4s ease-in-out; pointer-events: none; z-index: 0;
        }
        .group:hover .card-glow { opacity: 1; }
        .content-wrapper { position: relative; z-index: 1; }
        .oswald { font-family: 'Oswald', sans-serif; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;

        // --- Centralized API Fetch Utility ---
        const apiFetch = async (url, options = {}) => {
            const token = localStorage.getItem('jwt_token');
            const headers = { 'Content-Type': 'application/json', ...options.headers };
            if (token) { headers['Authorization'] = `Bearer ${token}`; }

            try {
                const response = await fetch(`https://sufianatdevx.pythonanywhere.com${url}`, { ...options, headers });
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({ message: `HTTP error! status: ${response.status}` }));
                    throw new Error(errorData.message);
                }
                return response.json();
            } catch (error) {
                console.error(`Fetch operation error on ${url}:`, error);
                throw error;
            }
        };

        // --- Reusable UI Components ---
        const Card = ({ children, className = '' }) => (
            <div className={`group relative p-6 bg-gray-900/50 backdrop-blur-sm rounded-3xl border border-purple-800/20 shadow-xl shadow-purple-900/10 ${className}`}>
                <div className="card-glow"></div>
                <div className="content-wrapper">{children}</div>
            </div>
        );
        const Input = (props) => <input {...props} className="w-full px-4 py-3 bg-gray-800/60 border border-purple-700/30 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500 transition-all duration-300" />;
        const Button = ({ children, onClick, className = '' }) => (
            <button onClick={onClick} className={`px-6 py-2.5 rounded-lg bg-gradient-to-r from-purple-600 to-indigo-700 text-white font-bold tracking-wide shadow-md transform transition-transform duration-300 hover:scale-105 focus:outline-none oswald ${className}`}>
                {children}
            </button>
        );
        const PageTitle = ({ children }) => <h2 className="text-4xl font-bold text-purple-300 mb-8 oswald">{children}</h2>;


        // --- Feature Components ---
        const SocialMedia = () => {
            const [accounts, setAccounts] = useState([]);
            const [platformName, setPlatformName] = useState('');
            const [profileUrl, setProfileUrl] = useState('');
            const [message, setMessage] = useState('');

            const fetchAccounts = useCallback(async () => {
                try { setAccounts(await apiFetch('/api/social/accounts')); }
                catch (error) { setMessage(`Error: ${error.message}`); }
            }, []);

            useEffect(() => { fetchAccounts(); }, [fetchAccounts]);

            const handleConnect = async () => {
                try {
                    const newAccount = await apiFetch('/api/social/connect', { method: 'POST', body: JSON.stringify({ name: platformName, profile_url: profileUrl }) });
                    setAccounts(prev => [...prev, newAccount]);
                    setPlatformName(''); setProfileUrl('');
                    setMessage('Connected!');
                } catch (error) { setMessage(`Error: ${error.message}`); }
            };
            return (
                 <div>
                    <PageTitle>Social Media Management</PageTitle>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6 text-white">
                        <Card>
                            <h3 className="text-2xl font-bold mb-4 oswald">Connect New Account</h3>
                            <div className="space-y-4">
                                <Input placeholder="Platform Name (e.g., Upwork)" value={platformName} onChange={e => setPlatformName(e.target.value)} />
                                <Input placeholder="Profile URL" value={profileUrl} onChange={e => setProfileUrl(e.target.value)} />
                                <Button onClick={handleConnect}>Connect</Button>
                            </div>
                        </Card>
                        <Card>
                            <h3 className="text-2xl font-bold mb-4 oswald">Your Connected Accounts</h3>
                            <ul className="space-y-2">{accounts.map(acc => <li key={acc.id} className="p-2 bg-gray-800/70 rounded">{acc.name}</li>)}</ul>
                        </Card>
                    </div>
                 </div>
            );
        };

        const Proposals = () => {
             const [jobs, setJobs] = useState([]);
             const [generatedProposal, setGeneratedProposal] = useState("");
             useEffect(() => {
                apiFetch('/api/proposals/find-jobs').then(setJobs).catch(console.error);
             }, []);
             const handleGenerate = (jobTitle) => {
                 apiFetch('/api/proposals/generate', {method: 'POST', body: JSON.stringify({ job_title: jobTitle })})
                    .then(data => setGeneratedProposal(data.proposal))
                    .catch(console.error);
             }
             return (
                 <div>
                    <PageTitle>Proposal Generation</PageTitle>
                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <Card>
                             <h3 className="text-2xl font-bold mb-4 oswald">Available Jobs</h3>
                             <div className="space-y-3 max-h-96 overflow-y-auto pr-2">
                                {jobs.map(job => (
                                    <div key={job.id} className="p-4 bg-gray-800/70 rounded-lg">
                                        <h4 className="font-bold text-purple-400">{job.title}</h4>
                                        <p className="text-sm text-gray-400">{job.description}</p>
                                        <Button onClick={() => handleGenerate(job.title)} className="mt-2">Generate Proposal</Button>
                                    </div>
                                ))}
                             </div>
                        </Card>
                        <Card>
                             <h3 className="text-2xl font-bold mb-4 oswald">Generated Proposal</h3>
                             <textarea readOnly value={generatedProposal} className="w-full h-80 p-3 bg-gray-800/60 border border-purple-700/30 rounded-lg text-gray-300"></textarea>
                        </Card>
                    </div>
                </div>
             );
        };
        
        const LoginScreen = ({ onLoginSuccess }) => {
            const [username, setUsername] = useState('');
            const [password, setPassword] = useState('');
            const [isRegister, setIsRegister] = useState(false);
            const [error, setError] = useState('');

            const handleSubmit = async (e) => {
                e.preventDefault();
                setError('');
                const endpoint = isRegister ? '/api/auth/register' : '/api/auth/login';
                try {
                    const data = await apiFetch(endpoint, { method: 'POST', body: JSON.stringify({ username, password }) });
                    if (isRegister) {
                        setIsRegister(false);
                        setError('Registration successful! Please log in.');
                    } else {
                        localStorage.setItem('jwt_token', data.access_token);
                        localStorage.setItem('username', username);
                        onLoginSuccess(username);
                    }
                } catch (err) { setError(err.message); }
            };

            return (
                 <div className="flex justify-center items-center pt-16">
                    <Card className="w-full max-w-sm">
                         <h2 className="text-3xl text-white font-bold text-center mb-6 oswald">{isRegister ? 'Create Account' : 'Welcome'}</h2>
                         <form onSubmit={handleSubmit} className="space-y-5">
                            <Input type="text" placeholder="Username" value={username} onChange={e => setUsername(e.target.value)} required />
                            <Input type="password" placeholder="Password" value={password} onChange={e => setPassword(e.target.value)} required />
                            <Button type="submit" className="w-full">{isRegister ? 'Register' : 'Login'}</Button>
                         </form>
                         {error && <p className="mt-4 text-center text-red-400">{error}</p>}
                         <button onClick={() => setIsRegister(!isRegister)} className="mt-5 text-center w-full text-indigo-400 hover:underline">
                            {isRegister ? 'Already have an account? Login' : 'Need an account? Register'}
                         </button>
                    </Card>
                </div>
            );
        };


        // --- Main App Component (Old Structure Restored) ---
        function App() {
            const [activeTab, setActiveTab] = useState('social');
            const [loggedInUser, setLoggedInUser] = useState(localStorage.getItem('username'));

            const handleLoginSuccess = (username) => {
                setLoggedInUser(username);
                setActiveTab('social');
            };

            const handleLogout = () => {
                localStorage.removeItem('jwt_token');
                localStorage.removeItem('username');
                setLoggedInUser(null);
            };
            
            const NavButton = ({ tabName, children }) => (
                <button
                    onClick={() => setActiveTab(tabName)}
                    className={`px-4 py-2 rounded-t-lg text-lg transition-colors duration-300 oswald ${activeTab === tabName ? 'bg-gray-900/50 text-purple-300 border-b-2 border-purple-400' : 'text-gray-400 hover:text-white'}`}
                >
                    {children}
                </button>
            );

            if (!loggedInUser) {
                return <div className="min-h-screen p-4 sm:p-8"><LoginScreen onLoginSuccess={handleLoginSuccess} /></div>;
            }

            return (
                <div className="min-h-screen p-4 sm:p-8">
                    {/* Background Orbs */}
                    <div className="absolute top-0 right-0 w-72 h-72 bg-purple-900/40 rounded-full filter blur-3xl opacity-50 floating-orb"></div>
                    <div className="absolute bottom-0 left-0 w-72 h-72 bg-indigo-900/40 rounded-full filter blur-3xl opacity-50 floating-orb" style={{animationDelay: '4s'}}></div>
                    
                    <div className="max-w-7xl mx-auto relative z-10">
                         <header className="flex justify-between items-center mb-6">
                            <div className="flex items-center gap-3">
                                <img src="https://devxhouse.com/download/kronos-logo.png" alt="Kronos Logo" className="h-10"/>
                                <h1 className="text-3xl font-bold oswald text-white">KRONOS</h1>
                            </div>
                             <div className="flex items-center gap-4">
                                <span className="text-gray-300">Welcome, {loggedInUser}</span>
                                <Button onClick={handleLogout}>Logout</Button>
                            </div>
                        </header>
                        
                        <nav className="border-b border-purple-800/20 mb-8">
                             <NavButton tabName="social">Social Media</NavButton>
                             <NavButton tabName="proposals">Proposals</NavButton>
                        </nav>
                        
                        <main>
                            {activeTab === 'social' && <SocialMedia />}
                            {activeTab === 'proposals' && <Proposals />}
                        </main>
                    </div>
                </div>
            );
        }

        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<App />);
    </script>
</body>
</html>