<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Kronos - Final Interface</title>

    <script src="https://cdn.tailwindcss.com"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=League+Spartan:wght@400;600;700&family=Oswald:wght@400;500;600;700&family=Saira:wght@400;600&display=swap" rel="stylesheet">

    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body { background-color: #000; font-family: 'Saira', sans-serif; overflow-x: hidden; }
        @keyframes float { 0% { transform: translate(0, 0); } 50% { transform: translate(0, 15px); } 100% { transform: translate(0, 0); } }
        .floating-orb { animation: float 6s ease-in-out infinite; }
        .card-glow {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: 1.5rem; /* 24px */
            background: radial-gradient(circle at 50% 50%, rgba(128, 0, 128, 0.4), transparent 70%);
            opacity: 0;
            transition: opacity 0.5s ease;
            pointer-events: none;
            z-index: 0;
        }
        .group:hover .card-glow { opacity: 1; }
        .content-wrapper { position: relative; z-index: 1; }
        .oswald { font-family: 'Oswald', sans-serif; }
        .saira { font-family: 'Saira', sans-serif; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;

        // --- Centralized API Fetch Utility ---
        const apiFetch = async (url, options = {}) => {
            const token = localStorage.getItem('jwt_token');
            const headers = {
                'Content-Type': 'application/json',
                ...options.headers,
            };

            if (token) {
                headers['Authorization'] = `Bearer ${token}`;
            }

            try {
                const response = await fetch(`https://sufianatdevx.pythonanywhere.com${url}`, {
                    ...options,
                    headers,
                });

                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({ message: response.statusText }));
                    console.error(`API Error on ${url}:`, response.status, errorData);
                    throw new Error(errorData.message || `HTTP error! status: ${response.status}`);
                }
                return await response.json();
            } catch (error) {
                console.error('Fetch operation error:', error);
                throw error;
            }
        };


        // --- Reusable UI Components ---
        const Card = ({ children, className = '' }) => (
            <div className={`group relative p-8 bg-gray-900/50 backdrop-blur-sm rounded-3xl border border-purple-800/20 shadow-2xl shadow-purple-900/20 ${className}`}>
                <div className="card-glow"></div>
                <div className="content-wrapper">{children}</div>
            </div>
        );

        const Input = ({ ...props }) => (
             <input {...props} className="w-full px-4 py-3 bg-gray-800/60 border border-purple-700/30 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500 transition-all duration-300" />
        );

        const Button = ({ children, onClick, className = '' }) => (
            <button
                onClick={onClick}
                className={`px-8 py-3 rounded-full bg-gradient-to-r from-purple-600 to-indigo-700 text-white text-lg font-bold tracking-wider shadow-lg transform transition-transform duration-300 hover:scale-105 focus:outline-none focus:ring-2 focus:ring-purple-400 focus:ring-opacity-75 oswald ${className}`}
            >
                {children}
            </button>
        );

        // --- Main Feature Components ---
        const SocialMedia = () => {
            const [accounts, setAccounts] = useState([]);
            const [platformName, setPlatformName] = useState('');
            const [profileUrl, setProfileUrl] = useState('');
            const [message, setMessage] = useState('');

            const fetchAccounts = useCallback(async () => {
                try {
                    const data = await apiFetch('/api/social/accounts');
                    setAccounts(data);
                } catch (error) {
                    setMessage(`Error fetching accounts: ${error.message}`);
                }
            }, []);

            useEffect(() => {
                fetchAccounts();
            }, [fetchAccounts]);

            const handleConnectPlatform = async () => {
                if (!platformName || !profileUrl) {
                    setMessage("Please provide both platform name and URL.");
                    return;
                }
                try {
                    const newAccount = await apiFetch('/api/social/connect', {
                        method: 'POST',
                        body: JSON.stringify({ name: platformName, profile_url: profileUrl })
                    });
                    setAccounts(prev => [...prev, newAccount]);
                    setPlatformName('');
                    setProfileUrl('');
                    setMessage('Successfully connected!');
                } catch (error) {
                    setMessage(`Error connecting account: ${error.message}`);
                }
            };

            const handleGenerateContent = async () => {
                try {
                    const data = await apiFetch('/api/social/generate-content', { method: 'POST' });
                    setMessage(`Generated Content: ${data.content}`);
                } catch (error) {
                    setMessage(`Error generating content: ${error.message}`);
                }
            };

            return (
                <div className="grid grid-cols-1 md:grid-cols-2 gap-8 text-white">
                    <Card>
                        <h3 className="text-3xl font-bold mb-6 oswald text-purple-300">Connect Social Accounts</h3>
                        <div className="space-y-4">
                            <Input placeholder="Platform Name (e.g., Instagram)" value={platformName} onChange={e => setPlatformName(e.target.value)} />
                            <Input placeholder="Profile URL" value={profileUrl} onChange={e => setProfileUrl(e.target.value)} />
                            <Button onClick={handleConnectPlatform}>Connect</Button>
                        </div>
                    </Card>
                    <Card>
                         <h3 className="text-3xl font-bold mb-6 oswald text-purple-300">Connected Platforms</h3>
                         <ul className="space-y-3">
                            {accounts.map(acc => <li key={acc.id} className="p-3 bg-gray-800/70 rounded-lg">{acc.name}: <a href={acc.profile_url} target="_blank" className="text-indigo-400 hover:underline">{acc.profile_url}</a></li>)}
                         </ul>
                    </Card>
                    <Card className="md:col-span-2">
                        <h3 className="text-3xl font-bold mb-6 oswald text-purple-300">Content Generation</h3>
                        <Button onClick={handleGenerateContent}>Generate Post Idea</Button>
                    </Card>
                    {message && <div className="md:col-span-2 p-4 bg-gray-800 rounded-lg text-center text-green-400">{message}</div>}
                </div>
            );
        };

        const Proposals = () => {
             const [platforms, setPlatforms] = useState([]);
             const [jobs, setJobs] = useState([]);
             const [message, setMessage] = useState('');

             useEffect(() => {
                const fetchData = async () => {
                    try {
                        const platformsData = await apiFetch('/api/proposals/platforms');
                        const jobsData = await apiFetch('/api/proposals/find-jobs');
                        setPlatforms(platformsData);
                        setJobs(jobsData);
                    } catch (error) {
                        setMessage(`Error fetching data: ${error.message}`);
                    }
                };
                fetchData();
             }, []);

             return (
                 <div className="grid grid-cols-1 md:grid-cols-2 gap-8 text-white">
                    <Card>
                        <h3 className="text-3xl font-bold mb-6 oswald text-purple-300">Your Platforms</h3>
                        <ul>{platforms.map(p => <li key={p.id}>{p.name}</li>)}</ul>
                    </Card>
                     <Card>
                        <h3 className="text-3xl font-bold mb-6 oswald text-purple-300">Found Jobs</h3>
                        <ul className="space-y-2">{jobs.map(j => <li key={j.id} className="p-2 bg-gray-800/50 rounded">{j.title} on {j.platform_name}</li>)}</ul>
                    </Card>
                     {message && <div className="md:col-span-2 p-4 bg-gray-800 rounded-lg text-center text-red-400">{message}</div>}
                </div>
            );
        };

        const Login = ({ onLoginSuccess }) => {
            const [username, setUsername] = useState('');
            const [password, setPassword] = useState('');
            const [isRegister, setIsRegister] = useState(false);
            const [error, setError] = useState('');

            const handleSubmit = async (e) => {
                e.preventDefault();
                setError('');
                const endpoint = isRegister ? '/api/auth/register' : '/api/auth/login';
                try {
                    const data = await apiFetch(endpoint, {
                        method: 'POST',
                        body: JSON.stringify({ username, password })
                    });
                    if (isRegister) {
                        setIsRegister(false);
                        setError('Registration successful! Please log in.');
                    } else {
                        localStorage.setItem('jwt_token', data.access_token);
                        localStorage.setItem('username', username);
                        onLoginSuccess(username);
                    }
                } catch (err) {
                    setError(err.message);
                }
            };

            return (
                <div className="flex justify-center items-center pt-10">
                    <Card className="w-full max-w-md">
                         <h2 className="text-4xl text-white font-bold text-center mb-8 oswald">{isRegister ? 'Create Account' : 'Welcome Back'}</h2>
                         <form onSubmit={handleSubmit} className="space-y-6">
                            <Input type="text" placeholder="Username" value={username} onChange={e => setUsername(e.target.value)} required />
                            <Input type="password" placeholder="Password" value={password} onChange={e => setPassword(e.target.value)} required />
                            <Button type="submit" className="w-full">{isRegister ? 'Register' : 'Login'}</Button>
                         </form>
                         {error && <p className="mt-4 text-center text-red-400">{error}</p>}
                         <p className="mt-6 text-center text-gray-400">
                             {isRegister ? "Already have an account?" : "Don't have an account?"}
                             <button onClick={() => setIsRegister(!isRegister)} className="ml-2 text-indigo-400 hover:underline font-bold">
                                 {isRegister ? 'Login' : 'Sign Up'}
                             </button>
                         </p>
                    </Card>
                </div>
            );
        };

        // --- Main App Component ---
        const App = () => {
            const [activeTab, setActiveTab] = useState('social');
            const [loggedInUser, setLoggedInUser] = useState(localStorage.getItem('username'));

            const handleLoginSuccess = (username) => {
                setLoggedInUser(username);
                setActiveTab('social'); // Redirect to a functional tab after login
            };

            const handleLogout = () => {
                localStorage.removeItem('jwt_token');
                localStorage.removeItem('username');
                setLoggedInUser(null);
                setActiveTab('login');
            };

            const renderContent = () => {
                if (!loggedInUser) return <Login onLoginSuccess={handleLoginSuccess} />;

                switch(activeTab) {
                    case 'social': return <SocialMedia />;
                    case 'proposals': return <Proposals />;
                    default: return <SocialMedia />;
                }
            };

            const NavButton = ({ tabName, children }) => (
                <button
                    onClick={() => setActiveTab(tabName)}
                    className={`px-5 py-2 rounded-md text-lg transition-all duration-300 oswald ${activeTab === tabName ? 'bg-purple-600 text-white' : 'text-gray-300 hover:bg-purple-800/50'}`}
                >
                    {children}
                </button>
            );

            return (
                <div className="min-h-screen bg-black text-white p-4 sm:p-8 relative">
                    {/* Background decorative elements */}
                    <div className="absolute top-0 left-0 w-64 h-64 bg-purple-900/50 rounded-full filter blur-3xl opacity-30 floating-orb"></div>
                    <div className="absolute bottom-0 right-0 w-64 h-64 bg-indigo-900/50 rounded-full filter blur-3xl opacity-30 floating-orb" style={{animationDelay: '3s'}}></div>

                    <div className="max-w-7xl mx-auto">
                        <header className="flex flex-wrap justify-between items-center mb-12">
                            <div className="flex items-center gap-4">
                                <img src="https://devxhouse.com/download/kronos-logo.png" alt="Kronos Logo" className="h-12"/>
                                <h1 className="text-4xl font-bold oswald">KRONOS</h1>
                            </div>
                            {loggedInUser ? (
                                <div className="flex items-center gap-4 mt-4 md:mt-0">
                                    <nav className="flex items-center gap-2 bg-gray-900/60 p-2 rounded-lg border border-purple-800/20">
                                        <NavButton tabName="social">Social Media</NavButton>
                                        <NavButton tabName="proposals">Proposals</NavButton>
                                    </nav>
                                    <span className="text-lg text-gray-300 mx-4">Welcome, {loggedInUser}!</span>
                                    <button onClick={handleLogout} className="px-6 py-3 rounded-full bg-gradient-to-r from-red-600 to-pink-700 text-white text-lg font-bold tracking-wider shadow-lg transform transition-transform duration-300 hover:scale-105 oswald">Logout</button>
                                </div>
                            ) : (
                                <Button onClick={() => setActiveTab('login')} className="mt-4 md:mt-0">Login</Button>
                            )}
                        </header>

                        <main className="min-h-[500px]">
                           {renderContent()}
                        </main>
                    </div>
                </div>
            );
        };

        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<App />);
    </script>
</body>
</html>